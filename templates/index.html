<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sugarcane Genome Hub - Gene Search</title>
    <style>/* Dùng CSS cũ của bạn */</style>
</head>
<body>
    <header>
        <h1>Sugarcane Genome Hub</h1>
    </header>
    <div class="container">
        <section>
            <h2>Gene Search</h2>
            <form id="geneSearchForm">
                <label for="species_select">Select Species:</label>
                <select id="species_select" name="species" required>
                    {% for species in species_list %}
                    <option value="{{ species }}">{{ species }}</option>
                    {% endfor %}
                </select>
                <label for="contig_id">Enter Contig/Gene ID (e.g., JAKOGQ010001029.1):</label>
                <input type="text" id="contig_id" name="contig_id" required>
                <button type="submit">Search</button>
            </form>
            <div id="result"></div>
        </section>

        <section>
            <h2>Tools</h2>
            <ul>
                <li><a href="{{ url_for('home') }}">Gene Search</a></li>
                <li><a href="{{ url_for('blast') }}">BLAST Search</a></li>
                </ul>
        </section>
    </div>

    <script>
        document.getElementById('geneSearchForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const species = document.getElementById('species_select').value;
            const contigId = document.getElementById('contig_id').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Loading...';
            resultDiv.style.display = 'block';

            const response = await fetch(`/api/gene_search?species=${species}&contig_id=${contigId}`);
            const data = await response.json();
            
            if (data.error) {
                resultDiv.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
            } else {
                // Định dạng hiển thị features chi tiết hơn
                let featuresHtml = '<ul>';
                if (data.features && data.features.length > 0) {
                    featuresHtml += data.features.map(f => {
                        const product = f.qualifiers.product ? f.qualifiers.product.join('; ') : 'N/A';
                        const note = f.qualifiers.note ? f.qualifiers.note.join('; ') : '';
                        return `<li>
                            <strong>${f.type}</strong> at ${f.location}
                            <br>Product: ${product}
                            <br>Note: ${note}
                        </li>`;
                    }).join('');
                } else {
                    featuresHtml += '<li>No annotated features (gene, CDS, etc.) found</li>';
                }
                featuresHtml += '</ul>';

                resultDiv.innerHTML = `
                    <h3>Results for Contig: ${data.contig_id} (${data.species})</h3>
                    <p><strong>Description:</strong> ${data.description}</p>
                    <p><strong>Length:</strong> ${data.sequence_length} bp</p>
                    <h4>Features:</h4>
                    ${featuresHtml}
                `;
            }
        });
    </script>
</body>
</html>